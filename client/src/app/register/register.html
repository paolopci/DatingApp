<form [formGroup]="registerForm" (ngSubmit)="register()" autocomplete="off">
    <h2 class="text-center text-primary">Sign Up</h2>
    <hr>

    <div class="mb-3">
        <label style="margin-right: 10px">I am a: </label>
        <label class="form-check-label">
            <input type="radio" value="male" formControlName="gender">Male
        </label>
        <label class="form-check-label">
            <input type="radio" value="female" formControlName="gender">Female
        </label>
    </div>

    <!-- Username -->
    <app-text-input [control]="$any(registerForm.get('username'))" [label]="'Username'" [type]="'text'"
        [requiredMessage]="'Username is required'" [id]="'register-username'" />



    <!-- knownAs -->
    <app-text-input [control]="$any(registerForm.get('knownAs'))" [label]="'KnownAs'" [type]="'text'"
        [requiredMessage]="'knownAs is required'" />
    <!-- dateOfBirth (ngbDatepicker) | strict dd/MM/yyyy -->
    <div class="mb-3 form-floating">
        <input
            class="form-control"
            id="register-date-of-birth"
            placeholder="Date Of Birth"
            [formControl]="$any(registerForm.get('dateOfBirth'))"
            ngbDatepicker
            #dob="ngbDatepicker"
            (click)="dob.open()"
            (input)="onDobInput($event)"
            [minDate]="minDob"
            [maxDate]="maxDob"
            [startDate]="maxDob"
            [class.is-invalid]="dobFormatInvalid || (registerForm.get('dateOfBirth')?.invalid && (registerForm.get('dateOfBirth')?.touched || registerForm.get('dateOfBirth')?.dirty))" />

        <label for="register-date-of-birth">Date Of Birth</label>

        @if (dobFormatInvalid) {
          <div class="invalid-feedback text-start d-block">Formato non valido. Usa dd/mm/yyyy (es. 09/04/2025).</div>
        }
        @if (registerForm.get('dateOfBirth')?.hasError('required') && (registerForm.get('dateOfBirth')?.touched || registerForm.get('dateOfBirth')?.dirty)) {
          <div class="invalid-feedback text-start d-block">Date Of Birth is required</div>
        }
    </div>
    <!-- City -->
    <app-text-input [control]="$any(registerForm.get('city'))" [label]="'City'" [type]="'text'"
        [requiredMessage]="'City is required'" />
    <!-- Country -->
    <app-text-input [control]="$any(registerForm.get('country'))" [label]="'Country'" [type]="'text'"
        [requiredMessage]="'Country is required'" />
    <!-- Password -->
    <app-text-input [control]="$any(registerForm.get('password'))" [label]="'Password'" [type]="'password'"
        [id]="'password'" />

    <!-- Confirm Password -->
    <app-text-input [control]="$any(registerForm.get('confirmPassword'))" [label]="'Confirm Password'"
        [type]="'password'" [id]="'confirmPassword'">
        <!-- Mismatch impostato sul controllo -->
        @if (registerForm.get('confirmPassword')?.hasError('notMatching') &&
        registerForm.get('confirmPassword')?.touched) {
        <div class="invalid-feedback text-start">Le password non coincidono</div>
        }
        <!-- Mismatch impostato a livello di form -->
        @if ((registerForm.hasError('notMatching') || registerForm.hasError('passwordMismatch')) &&
        registerForm.get('confirmPassword')?.touched) {
        <div class="invalid-feedback text-start">Le password non coincidono</div>
        }
    </app-text-input>

    <!-- Bottoni -->
    <div class="form-group text-center">
        <button type="submit" class="btn btn-primary" [disabled]="registerForm.invalid || dobFormatInvalid" [class.opacity-50]="registerForm.invalid || dobFormatInvalid">Register</button>
        <button type="button" class="btn btn-default" (click)="cancel()">Cancel</button>
    </div>
</form>

<!-- Debug -->
<p>Form value: {{ registerForm.value | json }}</p>
<p>Form status: {{ registerForm.status | json }}</p>
